<fieldset class="max-w-2xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-md">
  <h1 class="text-2xl font-bold mb-6 text-gray-800">アニメを記録する</h1>

  <%= form_with model: @post, local: true, class: "space-y-6" do |form| %>

    <div>
      <%= form.label :title, "アニメ題名", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_field :title, required: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>

    <div >
      <%= form.label :status, "視聴状況", class: "block text-sm font-medium text-gray-700" %>
      <%= form.select :status, [["みた", "watched"], ["みたい", "want_to_watch"]], {}, { id: "status-select", class: "form-select" } %>
    </div>

    <fieldset id="rating-field">
      <legend class="block text-sm font-medium text-gray-700 mb-1">評価</legend>
      <div class="star_rating flex flex-row-reverse justify-end">
        <% [5, 4, 3, 2, 1].each do |num| %>
          <%= form.radio_button :rating, num, id: "star#{num}", class: "hidden" %>
          <%= form.label :rating, "★", for: "star#{num}", class: "text-2xl text-gray-300 cursor-pointer peer-checked:text-yellow-400 hover:text-yellow-400 transition-colors" %>
        <% end %>
      </div>
    </fieldset>

    <div>
      <%= form.label :content, "感想", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_area :content, rows: 5, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>

    <%= form.submit "投稿する", class: "w-full mt-4 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition-colors" %>
  <% end %>
</fieldset>

<script>
  document.addEventListener('turbo:load', () => {
    const statusSelect = document.getElementById('status-select');
    const ratingField = document.getElementById('rating-field');

    // もしページ上にこのフォームがなかったら何もしない（エラー防止）
    if (!statusSelect || !ratingField) return;

    const toggleRating = () => {
      // 選択肢が "watched" なら表示、それ以外なら非表示
      if (statusSelect.value === 'watched') {
        ratingField.classList.remove('hidden');
      } else {
        ratingField.classList.add('hidden');
      }
    };

    // 選択が変わったとき
    statusSelect.addEventListener('change', toggleRating);

    // ページを読み込んだとき（初期表示）
    toggleRating();
  });
</script>